# 云开发菜谱库初始化说明

## 1. 菜谱 JSON 模型（爱料理结构）

- **主料 / 调料分块**：`main_ingredients`（主料）、`seasonings`（调料），便于 UI 分块显示。
- **步骤必带图**：每个 `steps[i]` 含 `step_image_url`，用于步骤页沉浸式头部或步骤图。

完整字段见 `data/recipeSchema.js` 顶部注释；示例数据见 `data/recipeSchema.sample.json`。

## 2. 开通云开发

1. 微信开发者工具 → 云开发 → 开通并创建环境，记下**环境 ID**。
2. 在 `project.config.json` 中可配置（可选）：
   ```json
   "cloudfunctionRoot": "cloudfunctions/"
   ```
3. 若需指定环境，在 `miniprogram/utils/cloudInitRecipes.js` 中修改 `DEFAULT_ENV` 为你的环境 ID；留空则使用项目默认环境。

## 3. 初始化数据库

**方式一：控制台执行（推荐）**

1. 真机或模拟器运行小程序。
2. 打开调试器 → Console，执行：
   ```js
   getApp().initRecipesCollection()
   ```
3. 若集合已有数据仍要追加示例，执行：
   ```js
   getApp().initRecipesCollection({ force: true })
   ```

**方式二：指定环境**

```js
getApp().initRecipesCollection({ env: '你的环境ID', force: true })
```

**方式三：云开发控制台手动导入**

1. 云开发 → 数据库 → 新建集合 `recipes`。
2. 在集合中「导入」→ 选择 JSON 文件，可使用 `data/recipeSchema.sample.json` 中的一条（需拆成单条文档格式，或使用控制台支持的 JSON 数组导入）。

## 4. 集合与权限

- **集合名**：`recipes`（大人与宝宝菜谱可同集合，用 `type: 'adult' | 'baby'` 区分；或拆成 `recipes` / `baby_recipes`）。
- **权限**：按需在云开发控制台设置「仅创建者可读写」或「所有用户可读」等。

初始化完成后，可在云开发控制台「数据库」中查看 `recipes` 集合及文档。

## 5. 菜谱封面图：语义化命名规范（半自动 AI 资产流水线）

为让代码自动拼出封面图地址、避免硬编码，约定云存储中图片按「菜名 → 拼音短横线」命名。

- **命名格式**：`{菜名对应 slug}.jpg`，小写、短横线分隔。示例：杭椒牛柳 → `hang-jiao-niu-liu.jpg`。
- **映射表**：`miniprogram/data/recipeCoverSlugs.js` 中的 `RECIPE_NAME_TO_SLUG`，与 `recipes.js` 的 `name` 一一对应。
- **代码用法**：`imgUrl = getRecipeCoverImageUrl(item.name)` 或 `getRecipeCoverImage(item.name)`，自动得到 `{BASE_URL}/{slug}.jpg`。
- **兜底**：未在表中配置的菜名使用 `basic_cut_0_3_ar4.5.jpeg`。
- **新增菜**：在 `recipeCoverSlugs.js` 的 `RECIPE_NAME_TO_SLUG` 增加一行「菜名 → slug」，上传同名 `.jpg` 到云存储即可。
