<view class="steps-container">
  <view class="steps-header">
    <image wx:if="{{currentStepImage}}" class="header-ambient-bg" src="{{currentStepImage}}" mode="aspectFill" />
    <view class="header-mask"></view>
    
    <view class="header-content">
      <view class="hero-section">
        <view class="progress-visual">
          <view class="progress-ring" style="background: conic-gradient(#E8A87C {{progressPercentage}}%, rgba(255,255,255,0.2) 0%)"></view>
          <image wx:if="{{currentStepImage}}" class="dish-mini-img" src="{{currentStepImage}}" mode="aspectFill" />
        </view>
        
        <view class="step-info">
          <text class="progress-text">{{progressPercentage}}% Â· {{completedCount}}/{{totalSteps}} æ­¥</text>
          <text class="step-main-title">{{currentStepTitle}}</text>
          <text class="step-sub-title">{{currentStepSubtitle}}</text>
        </view>
      </view>
    </view>
  </view>

  <view class="page-content">
    <view class="timeline-container">
      <view
        wx:for="{{steps}}"
        wx:key="id"
        class="timeline-item {{item.stepType}} {{item.completed ? 'completed' : ''}} {{index === (steps.length - 1) ? 'is-last' : ''}} {{index === currentIndex ? 'active' : ''}}"
        id="step-{{item.id}}"
        bindtap="onStepTap"
        data-index="{{index}}"
      >
        <!-- é˜¶æ®µåˆ†éš”æ¨ªå¹…ï¼šå¤‡èœé˜¶æ®µ / çƒ¹é¥ªé˜¶æ®µ -->
        <view wx:if="{{item.isPhaseStart && item.phaseType === 'prep'}}" class="phase-divider prep-phase">
          <view class="phase-icon">ğŸ”ª</view>
          <text class="phase-title">å¤‡èœé˜¶æ®µ</text>
        </view>
        <view wx:if="{{item.isPhaseStart && item.phaseType === 'cook'}}" class="phase-divider cook-phase">
          <view class="phase-icon">ğŸ”¥</view>
          <text class="phase-title">å¼€ç«çƒ¹é¥ª</text>
        </view>

        <!-- å·¦ä¾§æ—¶é—´è½´çº¿ -->
        <view class="timeline-rail">
          <view class="timeline-dot {{item.stepType === 'prep' ? 'dot-knife' : 'dot-fire'}}"></view>
          <view class="timeline-line {{item.stepType === 'prep' ? 'line-dashed' : 'line-solid'}}"></view>
          <!-- å®å®åˆ†æ”¯ -->
          <view class="baby-branch" wx:if="{{item.roleTag === 'å®å®é¤'}}">
            <view class="baby-dot">ğŸ¼</view>
          </view>
        </view>

        <!-- å³ä¾§æ­¥éª¤å¡ç‰‡ -->
        <view class="timeline-content">
          <view class="step-card {{item.completed ? 'completed' : ''}} {{index === (steps.length - 1) ? 'is-last' : ''}}">
            <view class="step-card__header">
              <view class="step-card__title-row">
                <text class="step-card__title">{{item.title}}</text>
                <text wx:if="{{item.roleTag}}" class="role-badge {{item.roleTag === 'æˆäººé¤' ? 'adult' : 'baby'}}">{{item.roleTag}}</text>
                <text wx:if="{{item.knifeWorkLabel}}" class="type-badge">{{item.knifeWorkLabel}}</text>
              </view>
              <view class="step-card__meta">
                é¢„è®¡ç”¨æ—¶ï¼š{{item.duration}} åˆ†é’Ÿ
              </view>
            </view>

            <view class="step-card__body">
              <view class="step-details">
                <view
                  wx:for="{{item.details}}"
                  wx:for-item="line"
                  wx:key="index"
                  class="detail-line {{line.isBabyPortion ? 'baby-portion-action' : ''}}"
                >
                  <text
                    wx:for="{{line.segments}}"
                    wx:for-item="seg"
                    wx:key="index"
                    class="{{seg.strong ? 'detail-strong' : ''}}"
                  >
                    {{seg.text}}
                  </text>
                </view>
              </view>

              <view wx:if="{{item.showSeasoningsList}}" class="ingredients-check">
                <view class="ing-grid seasonings-slider">
                  <text wx:for="{{item.seasoningsList}}" wx:for-item="ing" wx:key="name" class="ing-item">
                    <text class="ing-n">{{ing.name}}</text>
                    <text class="ing-a">{{ing.amount}}</text>
                  </text>
                </view>
              </view>

              <button
                class="step-action-btn {{item.completed ? 'is-done' : ''}}"
                bindtap="markCompleted"
                data-id="{{item.id}}"
              >
                {{item.completed ? 'æ­¥éª¤è¾¾æˆ' : 'æ ‡è®°å®Œæˆ'}}
              </button>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <view class="share-footer">
    <button class="share-btn" open-type="share">åˆ†äº«ä»Šæ—¥èœå•</button>
  </view>
</view>