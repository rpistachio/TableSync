<view class="mix-container">

  <!-- â•â•â• é¡¶éƒ¨æ ‡é¢˜åŒº â•â•â• -->
  <view class="mix-header">
    <text class="mix-title">ä»Šæ™šåƒä»€ä¹ˆï¼Ÿ</text>
    <text class="mix-subtitle">è‡ªç”±æ­é…ä½ çš„å®Œç¾æ™šé¤</text>
  </view>

  <!-- â•â•â• ç”¨é¤äººæ•° â•â•â• -->
  <view class="people-section">
    <text class="people-label">ç”¨é¤äººæ•°</text>
    <view class="people-stepper">
      <view class="stepper-btn {{adultCount <= 1 ? 'disabled' : ''}}" bindtap="onAdultCountMinus">
        <text class="stepper-btn-text">âˆ’</text>
      </view>
      <text class="stepper-value">{{adultCount}} äºº</text>
      <view class="stepper-btn {{adultCount >= 6 ? 'disabled' : ''}}" bindtap="onAdultCountPlus">
        <text class="stepper-btn-text">+</text>
      </view>
    </view>
  </view>

  <!-- â•â•â• å·²é€‰èœè°±åˆ—è¡¨ â•â•â• -->
  <view class="selected-section">
    <view class="section-header">
      <text class="section-title">å·²é€‰èœè°±</text>
      <text class="section-badge" wx:if="{{selectedRecipes.length > 0}}">{{selectedRecipes.length}} é“</text>
      <view class="clear-all-btn" bindtap="onClearAll" wx:if="{{selectedRecipes.length > 1}}">
        <text class="clear-all-text">æ¸…ç©º</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{selectedRecipes.length === 0}}">
      <text class="empty-icon">ğŸ½</text>
      <text class="empty-text">è¿˜æ²¡æœ‰é€‰æ‹©èœè°±</text>
      <text class="empty-hint">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ åŸç”Ÿæˆ–å¯¼å…¥èœè°±</text>
    </view>

    <!-- å·²é€‰èœè°±å¡ç‰‡ -->
    <view class="selected-list" wx:if="{{selectedRecipes.length > 0}}">
      <view class="recipe-card" wx:for="{{selectedRecipes}}" wx:key="id">
        <view class="recipe-card-main">
          <image
            wx:if="{{item._coverHttpUrl || item._coverTempUrl}}"
            class="recipe-card-thumb"
            src="{{item._coverHttpUrl || item._coverTempUrl}}"
            mode="aspectFill"
          />
          <view class="recipe-card-thumb-placeholder" wx:else>
            <text class="recipe-card-thumb-emoji">ğŸ³</text>
          </view>
          <view class="recipe-card-left">
            <text class="recipe-card-name">{{item.name}}</text>
            <view class="recipe-card-meta">
              <text class="recipe-card-source recipe-card-source-{{item._sourceType}}">{{item._sourceType === 'external' ? 'å¯¼å…¥' : 'åŸç”Ÿ'}}</text>
              <text class="recipe-card-meta-text" wx:if="{{item._cookTypeLabel}}">{{item._cookTypeLabel}}</text>
              <text class="recipe-card-meta-dot" wx:if="{{item._cookTypeLabel && item._meatLabel}}">Â·</text>
              <text class="recipe-card-meta-text" wx:if="{{item._meatLabel}}">{{item._meatLabel}}</text>
            </view>
          </view>
          <view class="recipe-card-remove" catchtap="onRemoveRecipe" data-index="{{index}}">
            <text class="recipe-card-remove-icon">Ã—</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- â•â•â• æ·»åŠ èœè°±æŒ‰é’® â•â•â• -->
  <view class="add-section" wx:if="{{selectedRecipes.length < maxDishes}}">
    <view class="add-btn" bindtap="onShowAddPanel">
      <text class="add-btn-icon">+</text>
      <text class="add-btn-text">æ·»åŠ èœè°±</text>
    </view>
  </view>

  <!-- â•â•â• ç»Ÿç­¹é¢„è§ˆ â•â•â• -->
  <view class="schedule-section" wx:if="{{selectedRecipes.length > 0}}">
    <view class="section-header">
      <text class="section-title">ç»Ÿç­¹é¢„è§ˆ</text>
      <view class="efficiency-badge" wx:if="{{schedulePreview.efficiency > 0}}">
        <text class="efficiency-badge-text">æ•ˆç‡ +{{schedulePreview.efficiency}}%</text>
      </view>
    </view>

    <!-- æ ¸å¿ƒæ•°æ®å¡ç‰‡ -->
    <view class="schedule-grid">
      <view class="schedule-item schedule-item-time">
        <text class="schedule-value">{{schedulePreview.totalTime}}</text>
        <text class="schedule-unit">åˆ†é’Ÿ</text>
        <text class="schedule-label">é¢„è®¡æ€»æ—¶é•¿</text>
      </view>
      <view class="schedule-item schedule-item-stove">
        <text class="schedule-value">{{schedulePreview.stoveCount || 1}}</text>
        <text class="schedule-unit">ä¸ª</text>
        <text class="schedule-label">å³°å€¼ç¶å°</text>
      </view>
      <view class="schedule-item schedule-item-save" wx:if="{{schedulePreview.savedTime > 0}}">
        <text class="schedule-value">-{{schedulePreview.savedTime}}</text>
        <text class="schedule-unit">åˆ†é’Ÿ</text>
        <text class="schedule-label">ç»Ÿç­¹èŠ‚çœ</text>
      </view>
    </view>

    <!-- è®¾å¤‡éœ€æ±‚æ ‡ç­¾ -->
    <view class="schedule-devices" wx:if="{{schedulePreview.devices.length > 0}}">
      <view class="schedule-device-tag" wx:for="{{schedulePreview.devices}}" wx:key="key">
        <text class="schedule-device-name">{{item.name}}</text>
        <text class="schedule-device-count">Ã—{{item.count}}</text>
      </view>
    </view>

    <!-- çƒ¹é¥ªé¡ºåºæ—¶é—´çº¿ -->
    <view class="cooking-timeline" wx:if="{{schedulePreview.cookingOrder.length > 0}}">
      <view class="timeline-title">
        <text class="timeline-title-text">æœ€ä½³çƒ¹é¥ªé¡ºåº</text>
      </view>
      <view class="timeline-list">
        <view class="timeline-item" wx:for="{{schedulePreview.cookingOrder}}" wx:key="phase">
          <view class="timeline-dot-wrap">
            <view class="timeline-dot">
              <text class="timeline-dot-icon">{{item.icon}}</text>
            </view>
            <view class="timeline-line" wx:if="{{index < schedulePreview.cookingOrder.length - 1}}"></view>
          </view>
          <view class="timeline-content">
            <view class="timeline-phase-row">
              <text class="timeline-phase">{{item.phase}}</text>
              <text class="timeline-time">{{item.time}}</text>
            </view>
            <text class="timeline-dishes">{{item.dishesText}}</text>
            <text class="timeline-note">{{item.note}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ™ºèƒ½å»ºè®® -->
    <view class="schedule-tips" wx:if="{{schedulePreview.tips.length > 0}}">
      <view class="schedule-tip" wx:for="{{schedulePreview.tips}}" wx:key="*this">
        <text class="schedule-tip-icon">ğŸ’¡</text>
        <text class="schedule-tip-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- â•â•â• åº•éƒ¨æ“ä½œæ  â•â•â• -->
  <view class="bottom-actions" wx:if="{{selectedRecipes.length > 0}}">
    <button class="action-btn action-btn-secondary" bindtap="onGenerateShoppingOnly">
      <text class="action-btn-secondary-text">è´­ç‰©æ¸…å•</text>
    </button>
    <button class="action-btn action-btn-helper" bindtap="onGoHelperMode">
      <text class="action-btn-helper-text">è®©åˆ«äººåš</text>
    </button>
    <button class="action-btn action-btn-primary" bindtap="onGenerate">
      <text class="action-btn-text">å¼€å§‹åš</text>
    </button>
  </view>

  <!-- â•â•â• æ·»åŠ èœè°±å¼¹å‡ºé¢æ¿ â•â•â• -->
  <view class="panel-mask {{showAddPanel ? 'is-visible' : ''}}" bindtap="onHideAddPanel"></view>
  <view class="add-panel {{showAddPanel ? 'is-visible' : ''}}">
    <!-- é¢æ¿æ ‡é¢˜ -->
    <view class="panel-header">
      <text class="panel-title">æ·»åŠ èœè°±</text>
      <view class="panel-close" bindtap="onHideAddPanel">
        <text class="panel-close-icon">Ã—</text>
      </view>
    </view>

    <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
    <view class="panel-tabs">
      <view class="panel-tab {{addPanelTab === 'native' ? 'is-active' : ''}}" data-tab="native" bindtap="onSwitchAddTab">
        <text class="panel-tab-icon">ğŸ“š</text>
        <text class="panel-tab-text">åŸç”Ÿèœè°±åº“</text>
      </view>
      <view class="panel-tab {{addPanelTab === 'imported' ? 'is-active' : ''}}" data-tab="imported" bindtap="onSwitchAddTab">
        <text class="panel-tab-icon">ğŸ”—</text>
        <text class="panel-tab-text">æœ€è¿‘å¯¼å…¥</text>
      </view>
    </view>

    <!-- åŸç”Ÿèœè°±åˆ—è¡¨ -->
    <view class="panel-content" wx:if="{{addPanelTab === 'native'}}">
      <!-- åˆ†ç±»è¿‡æ»¤ -->
      <scroll-view class="filter-bar" scroll-x enhanced show-scrollbar="{{false}}">
        <view class="filter-bar-inner">
          <view
            wx:for="{{nativeFilterOptions}}"
            wx:key="value"
            class="filter-tag {{nativeFilter === item.value ? 'is-active' : ''}}"
            data-filter="{{item.value}}"
            bindtap="onNativeFilter"
          >
            <text class="filter-tag-text">{{item.label}}</text>
          </view>
        </view>
      </scroll-view>
      <!-- èœè°±åˆ—è¡¨ -->
      <scroll-view class="recipe-scroll" scroll-y enhanced show-scrollbar="{{false}}">
        <view class="recipe-pick-list">
          <view
            class="recipe-pick-item"
            wx:for="{{filteredNativeRecipes}}"
            wx:key="id"
            data-index="{{index}}"
            bindtap="onSelectNativeRecipe"
          >
            <image
              wx:if="{{item._coverHttpUrl || item._coverTempUrl}}"
              class="recipe-pick-thumb"
              src="{{item._coverHttpUrl || item._coverTempUrl}}"
              mode="aspectFill"
            />
            <view class="recipe-pick-thumb-placeholder" wx:else>
              <text class="recipe-pick-thumb-emoji">ğŸ³</text>
            </view>
            <view class="recipe-pick-info">
              <text class="recipe-pick-name">{{item.name}}</text>
              <view class="recipe-pick-meta">
                <text class="recipe-pick-meta-tag">{{item._meatLabel || item.meat}}</text>
                <text class="recipe-pick-meta-tag" wx:if="{{item._cookTypeLabel || item.cook_type}}">{{item._cookTypeLabel || item.cook_type}}</text>
              </view>
            </view>
            <text class="recipe-pick-add">+</text>
          </view>
        </view>
        <view class="recipe-pick-empty" wx:if="{{filteredNativeRecipes.length === 0}}">
          <text class="recipe-pick-empty-text">æš‚æ— èœè°±</text>
        </view>
      </scroll-view>
    </view>

    <!-- å·²å¯¼å…¥èœè°±åˆ—è¡¨ -->
    <view class="panel-content" wx:if="{{addPanelTab === 'imported'}}">
      <scroll-view class="recipe-scroll" scroll-y enhanced show-scrollbar="{{false}}">
        <view class="recipe-pick-list">
          <view
            class="recipe-pick-item"
            wx:for="{{importedRecipes}}"
            wx:key="id"
            data-index="{{index}}"
            bindtap="onSelectImportedRecipe"
          >
            <image
              wx:if="{{item._coverHttpUrl || item._coverTempUrl}}"
              class="recipe-pick-thumb"
              src="{{item._coverHttpUrl || item._coverTempUrl}}"
              mode="aspectFill"
            />
            <view class="recipe-pick-thumb-placeholder" wx:else>
              <text class="recipe-pick-thumb-emoji">ğŸ³</text>
            </view>
            <view class="recipe-pick-info">
              <text class="recipe-pick-name">{{item.name}}</text>
              <view class="recipe-pick-meta">
                <text class="recipe-pick-meta-tag recipe-pick-meta-external">å¤–éƒ¨å¯¼å…¥</text>
                <text class="recipe-pick-meta-tag" wx:if="{{item.sourcePlatform}}">{{item.sourcePlatform}}</text>
              </view>
            </view>
            <text class="recipe-pick-add">+</text>
          </view>
        </view>
        <view class="recipe-pick-empty" wx:if="{{importedRecipes.length === 0}}">
          <text class="recipe-pick-empty-text">è¿˜æ²¡æœ‰å¯¼å…¥è¿‡èœè°±</text>
        </view>
      </scroll-view>
      <!-- ä»æˆ‘çš„èœè°±åº“é€‰æ‹© -->
      <view class="import-new-btn import-library-btn" bindtap="onGoMyRecipes">
        <text class="import-new-icon">ğŸ“š</text>
        <text class="import-new-text">ä»æˆ‘çš„èœè°±åº“é€‰æ‹©</text>
      </view>
      <!-- å¯¼å…¥æ–°èœè°±å…¥å£ -->
      <view class="import-new-btn" bindtap="onGoImportNew">
        <text class="import-new-icon">ğŸ”—</text>
        <text class="import-new-text">å¯¼å…¥æ–°èœè°±</text>
      </view>
    </view>
  </view>

</view>
