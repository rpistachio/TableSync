<view class="collection-page">
  <!-- 封面卡片区 -->
  <view class="collection-cover">
    <text class="collection-title">烟火集</text>
    <view class="collection-divider">
      <view class="collection-divider-line"></view>
      <text class="collection-divider-dot">✦</text>
      <view class="collection-divider-line"></view>
    </view>
    <text class="collection-desc">完成烹饪与分享，收集贴纸</text>
    <!-- 进度可视化：圆点列 -->
    <view class="collection-progress-dots">
      <view wx:for="{{earnedList}}" wx:key="id"
            class="progress-dot {{item.earned ? 'is-lit' : ''}}">
        <view class="progress-dot-inner"></view>
      </view>
    </view>
    <text class="collection-progress-text">{{totalEarned}} / {{totalDefs}}</text>
  </view>

  <!-- 口味画像卡片 -->
  <view class="taste-portrait" wx:if="{{tastePortrait}}">
    <view class="taste-portrait-header">
      <text class="taste-portrait-title">我的味觉</text>
      <text class="taste-portrait-cooks" wx:if="{{tastePortrait.totalCooks > 0}}">已做 {{tastePortrait.totalCooks}} 餐</text>
    </view>

    <view class="taste-bars" wx:if="{{tastePortrait.topFlavors.length > 0}}">
      <text class="taste-section-label">口味偏好</text>
      <view class="taste-bar-row" wx:for="{{tastePortrait.topFlavors}}" wx:key="key">
        <text class="taste-bar-label">{{item.label}}</text>
        <view class="taste-bar-track">
          <view class="taste-bar-fill" style="width: {{item.value > 10 ? 100 : item.value * 10}}%"></view>
        </view>
      </view>
    </view>

    <view class="taste-tags" wx:if="{{tastePortrait.topIngredients.length > 0}}">
      <text class="taste-section-label">偏好食材</text>
      <view class="taste-tag-list">
        <text class="taste-tag" wx:for="{{tastePortrait.topIngredients}}" wx:key="key">{{item.label}}</text>
      </view>
    </view>

    <view class="taste-avoid" wx:if="{{tastePortrait.avoidList.length > 0}}">
      <text class="taste-section-label">忌口</text>
      <view class="taste-tag-list">
        <text class="taste-tag taste-tag-avoid" wx:for="{{tastePortrait.avoidList}}" wx:key="*this">{{item}}</text>
      </view>
    </view>
  </view>

  <view class="collection-grid">
    <view
      wx:for="{{earnedList}}"
      wx:key="id"
      class="sticker-cell {{item.earned ? 'is-earned' : ''}} {{item.tapePos === 'left' ? 'tape-left' : 'tape-right'}}"
      style="transform: rotate({{item.rotation}}deg) translateX({{item.offsetX}}rpx);"
    >
      <view class="sticker-cell-inner">
        <view class="sticker-seal-wrap">
          <image wx:if="{{item.stickerImageUrl}}" class="sticker-cell-img" src="{{item.stickerImageUrl}}" mode="aspectFit" />
          <text wx:else class="sticker-cell-emoji">{{item.earned ? item.emoji : '○'}}</text>
        </view>
        <text class="sticker-cell-name">{{item.name}}</text>
        <text class="sticker-cell-desc">{{item.desc}}</text>
        <text wx:if="{{item.earned && item.repeatable}}" class="sticker-cell-count">×{{item.count}}/{{item.maxCount}}</text>
      </view>
    </view>
  </view>
</view>
