<view class="shopping-page">
  <view class="page-header">
    <image class="page-header-bg" src="{{heroCoverImage}}" mode="aspectFill"></image>
    <view class="header-mask"></view>
    <view class="header-content">
      <text class="curation-tag">Shopping List</text>
      <text class="main-title">é‡‡è´­æ¸…å•</text>
      <text class="sub-title">{{currentDishName}} Â· æ‰€éœ€é£Ÿæ</text>
      <view wx:if="{{todayPrepTime > 0 || todayAllergens.length > 0}}" class="meta-tags">
        <text wx:if="{{todayPrepTime > 0}}" class="meta-tag prep-tag">å‡†å¤‡çº¦ {{todayPrepTime}} åˆ†é’Ÿ</text>
        <text wx:if="{{todayAllergensText}}" class="meta-tag allergen-tag">å«è¿‡æ•åŸï¼š{{todayAllergensText}}</text>
      </view>
    </view>
  </view>
  <view class="page-content">
    <view class="toolbar">
      <picker mode="selector" range="{{sortOptions}}" range-key="text" value="{{sortIndex}}" bindchange="onSortChange">
        <view class="picker-label">{{sortOptions[sortIndex].text}}</view>
      </picker>
    </view>

    <view wx:if="{{helperBannerText}}" class="helper-banner">
      <text class="helper-banner-text">{{helperBannerText}}</text>
    </view>


    <block wx:if="{{groupedTodayItems.length > 0}}">
      <view wx:for="{{groupedTodayItems}}" wx:key="category" class="category-card">
        <view class="category-card__title">{{item.category}}</view>
        <view class="category-card__list">
          <view
            wx:for="{{item.items}}"
            wx:for-item="row"
            wx:for-index="rowIndex"
            wx:key="id"
            class="list-row {{row.checked ? 'is-done' : ''}} {{row.fridgeHas ? 'fridge-has' : ''}} {{rowIndex % 2 === 1 ? 'stripe' : ''}}"
            bindtap="onCheckToday"
            data-item="{{row}}"
          >
            <view class="custom-check">
              <icon wx:if="{{row.checked}}" type="success_no_circle" size="12" color="#fff"/>
            </view>
            <view class="list-row__body">
              <view class="name-amount-row">
                <text class="list-row__name">{{row.name}}</text>
                <text class="list-row__amount">{{row.displayAmount != null ? row.displayAmount : row.amount}}</text>
              </view>
              <text wx:if="{{row.fridgeHas}}" class="fridge-tag">ğŸ§Š å†°ç®±å·²æœ‰</text>
              <text wx:if="{{row.isShared}}" class="shared-tag">å¤šèœå…±ç”¨</text>
              <text wx:if="{{row.hasExternalSource && !row.isShared}}" class="shared-tag external-tag">å¤–éƒ¨èœè°±</text>
              <text wx:if="{{row.fromRecipesText}}" class="from-recipes-hint">{{row.fromRecipesText}}</text>
            </view>
          </view>
        </view>
      </view>
    </block>
    <view wx:else class="empty-hint">æš‚æ— æ•°æ®ï¼Œè¯·å…ˆåœ¨é¦–é¡µç”Ÿæˆä»Šæ—¥èœå•</view>
  </view>

  <view class="fixed-bottom-bar">
    <button class="btn-go-steps" bindtap="goToSteps">é£Ÿæå·²ä¹°é½</button>
  </view>
</view>
