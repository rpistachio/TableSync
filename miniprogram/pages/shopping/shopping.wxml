<view class="shopping-page">
  <view class="page-header">
    <text class="curation-tag">Shopping List</text>
    <text class="main-title">采购清单</text>
    <text class="sub-title">今日菜单所需食材，按分类查看</text>
    <view wx:if="{{todayPrepTime > 0 || todayAllergens.length > 0}}" class="meta-tags">
      <text wx:if="{{todayPrepTime > 0}}" class="meta-tag prep-tag">准备约 {{todayPrepTime}} 分钟</text>
      <text wx:if="{{todayAllergensText}}" class="meta-tag allergen-tag">含过敏原：{{todayAllergensText}}</text>
    </view>
  </view>
  <view class="page-content">
    <view class="toolbar">
      <picker mode="selector" range="{{sortOptions}}" range-key="text" value="{{sortIndex}}" bindchange="onSortChange">
        <view class="picker-label">{{sortOptions[sortIndex].text}}</view>
      </picker>
    </view>

    <view wx:if="{{todayTips.length > 0}}" class="today-tips">
      <text wx:for="{{todayTips}}" wx:key="*this" class="today-tip-line">{{item}}</text>
    </view>

    <block wx:if="{{groupedTodayItems.length > 0}}">
      <view wx:for="{{groupedTodayItems}}" wx:key="category" class="category-card">
        <view class="category-card__title">{{item.category}}</view>
        <view class="category-card__list">
          <view wx:for="{{item.items}}" wx:for-item="row" wx:key="id" class="list-row {{row.checked ? 'is-done' : ''}}">
            <checkbox value="{{row.id}}" checked="{{row.checked}}" bindtap="onCheckToday" data-item="{{row}}"/>
            <view class="list-row__body">
              <text class="list-row__name">{{row.name}}</text>
              <text class="list-row__amount">{{row.amount}}</text>
              <view class="list-row__tags">
                <text wx:if="{{row.isShared}}" class="tag tag-success">共用</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </block>
    <view wx:else class="empty-hint">暂无数据，请先在首页生成今日菜单</view>
  </view>

  <view class="fixed-bottom-bar">
    <button class="btn-go-steps" bindtap="goToSteps">食材已买齐，去备菜做饭</button>
  </view>
</view>
