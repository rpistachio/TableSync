<view class="preview-page">
  <view class="preview-page-scroll">
    <view class="preview-scroll-content">
      <view class="preview-header">
        <view class="preview-header-text">
          <text class="preview-header-title">营养师推荐理由</text>
          <text class="preview-narrative">{{previewNarrativeText}}</text>
        </view>
        <view class="preview-header-divider"></view>
      </view>

      <scroll-view wx:if="{{previewDashboard.estimatedTime || previewDashboard.stoveCount > 0 || previewDashboard.categoryLabels}}" class="dashboard-bar" scroll-x enable-flex>
        <view class="dash-item">
          <text class="dash-value">{{previewDashboard.estimatedTime}}</text>
        </view>
        <view class="dash-item">
          <text class="dash-value">{{previewDashboard.stoveCount}}火</text>
        </view>
        <view class="dash-item" wx:if="{{previewDashboard.categoryLabels}}">
          <text class="dash-value">{{previewDashboard.categoryLabels}}</text>
        </view>
      </scroll-view>

      <view class="preview-menu-header">
        <view class="preview-menu-titles">
          <text class="preview-menu-label">今日菜单</text>
          <text class="preview-menu-subtitle" wx:if="{{previewMenuSubtitle}}">{{previewMenuSubtitle}}</text>
        </view>
        <view class="preview-rhythm-inline" wx:if="{{previewRhythmRings.length > 0}}">
          <view wx:for="{{previewRhythmRings}}" wx:key="name" class="preview-rhythm-chip">
            <view class="preview-ring-svg-wrap">
              <svg class="preview-ring-svg" viewBox="0 0 100 100">
                <circle class="preview-ring-track" cx="50" cy="50" r="44"></circle>
                <circle class="preview-ring-progress" cx="50" cy="50" r="44" stroke="{{item.color}}" stroke-dasharray="{{item.dashArray}}"></circle>
              </svg>
            </view>
            <text class="preview-ring-label">{{item.name}}</text>
          </view>
        </view>
      </view>
      <view class="preview-baby-hint" wx:if="{{previewHasBaby}}">下方标「宝宝」的为宝宝辅食</view>
      <view class="preview-dish-list">
        <view wx:for="{{previewMenuRows}}" wx:key="index" class="dish-card-wrap" data-index="{{index}}" bindtap="onCheckRow">
          <view class="dish-card-modern {{item.checked ? '' : 'is-unchecked'}} {{item.hasCover ? '' : 'no-cover'}}" style="animation-delay: {{index * 120}}ms">
            <image wx:if="{{item.hasCover && isImageReady && item.coverTempUrl}}" class="card-bg" src="{{item.coverTempUrl}}" mode="aspectFill" />
            <view class="card-overlay"></view>
            <view class="basket-origin-badge" wx:if="{{item.fromBasket}}">
              <text class="basket-origin-text">{{item.basketSourceLabel}}</text>
            </view>
            <view class="card-info">
              <view class="card-header">
                <text class="dish-name">{{item.adultName}}</text>
                <view class="check-badge" wx:if="{{item.checked}}">✓</view>
              </view>
              <view class="card-footer">
                <text class="dish-reason">{{item.recommendReason}}</text>
                <view class="baby-tag-floating" wx:if="{{item.babyName}}">宝宝吃：{{item.babyName}}</view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <view class="preview-actions">
    <button class="preview-btn preview-btn-basket" catchtap="onAddAllToBasket">全员入篮</button>
    <button class="preview-btn preview-btn-secondary" catchtap="handleSwapOptions">换菜</button>
    <button class="preview-btn preview-btn-ghost" open-type="share">发给阿姨</button>
    <button class="preview-btn preview-btn-primary" catchtap="confirmAndGo">开始做饭</button>
  </view>
</view>
