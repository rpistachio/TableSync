<wxs src="./home.wxs" module="utils" />
<view class="home-container">
  <view class="brand-header">
    <view class="header-content">
      <image
        class="brand-logo {{logoZooming ? 'zoom-out' : ''}}"
        src="cloud://cloud1-7g5mdmib90e9f670.636c-cloud1-7g5mdmib90e9f670-1401654193/logo/logo-remove-removebg-preview.png"
        mode="widthFix"
      />
      <text class="brand-slogan">Eat. Connect. Automate.</text>
    </view>
  </view>

  <view class="selection-area">
    <view class="selection-group">
      <text class="group-label">å®¶åº­æˆå‘˜</text>
      <view class="people-picker">
        <view
          wx:for="{{adultCountOptions}}"
          wx:key="*this"
          class="people-item {{adultCount >= item ? 'is-lit' : ''}}"
          data-count="{{item}}"
          bindtap="onAdultCountTap"
        >
          <text class="people-icon">ğŸ‘¤</text>
        </view>
      </view>
      <text class="people-count-label">{{adultCount}} äºº</text>
    </view>
    <view class="selection-group">
      <text class="group-label">è¤ç´ æ­é…</text>
      <view class="combo-stack">
        <view wx:for="{{comboOptions}}" wx:key="label" class="combo-btn {{item.meatCount === meatCount && item.vegCount === vegCount && (item.soupCount || 0) === (soupCount || 0) ? 'is-active' : ''}}" data-meat="{{item.meatCount}}" data-veg="{{item.vegCount}}" data-soup="{{item.soupCount || 0}}" bindtap="onComboTap">
          <text class="combo-text">{{item.label}}</text>
          <text wx:if="{{item.tag}}" class="combo-tag">{{item.tag}}</text>
        </view>
      </view>
    </view>
    <view class="baby-toggle-row">
      <view
        class="baby-toggle-btn {{hasBaby ? 'is-active' : ''}}"
        bindtap="onBabyToggle"
      >
        <text class="baby-toggle-icon">ğŸ¼</text>
      </view>
      <text class="baby-toggle-label">{{hasBaby ? 'å®å®åŒè¡Œ' : 'æ— å®å®'}}</text>
    </view>
    <view wx:if="{{hasBaby}}" class="selection-group baby-age-section">
      <text class="group-label">å®å®æœˆé¾„</text>
      <view class="baby-age-stack">
        <view wx:for="{{babyAgeOptions}}" wx:key="value" class="baby-age-card {{item.value === babyMonth ? 'is-active' : ''}}" data-value="{{item.value}}" bindtap="onBabyAgeTap">
          <text class="baby-age-card-label">{{item.label}}</text>
          <text class="baby-age-card-sub">{{item.sub}}</text>
        </view>
      </view>
      <view class="baby-diff-tag">
        <text class="baby-diff-icon">ğŸ’¡</text>
        <text class="baby-diff-text">å¤§äººå­©å­å¯å…±ç”¨åŸºåº•ï¼Œä¸€é”…å‡ºæ›´çœå¿ƒ</text>
      </view>
    </view>
  </view>

  <!-- ä¸ªæ€§åŒ–åå¥½æŠ˜å é¢æ¿ -->
  <view class="pref-panel">
    <view class="pref-header" bindtap="togglePrefPanel">
      <text class="pref-header-text">å£å‘³ / åå¥½</text>
      <text class="pref-header-arrow {{prefExpanded ? 'is-expanded' : ''}}">â–¼</text>
    </view>
    <view class="pref-body {{prefExpanded ? 'is-expanded' : ''}}">
      <!-- å¿Œå£é€‰æ‹©ï¼ˆå¤šé€‰ï¼‰ -->
      <view class="pref-section">
        <text class="pref-label">å¿Œå£ï¼ˆå¯å¤šé€‰ï¼‰</text>
        <view class="pref-tag-group">
          <view 
            wx:for="{{avoidOptions}}" 
            wx:key="value" 
            class="pref-tag {{utils.includes(userPreference.avoidList, item.value) ? 'is-selected' : ''}}"
            data-value="{{item.value}}"
            bindtap="onAvoidTap"
          >
            <text>{{item.label}}</text>
          </view>
        </view>
      </view>
      <!-- é¥®é£Ÿåå¥½ï¼ˆå•é€‰ï¼‰ -->
      <view class="pref-section">
        <text class="pref-label">é¥®é£Ÿåå¥½</text>
        <view class="pref-tag-group">
          <view 
            wx:for="{{dietOptions}}" 
            wx:key="value" 
            class="pref-tag {{userPreference.dietStyle === item.value ? 'is-selected' : ''}}"
            data-value="{{item.value}}"
            bindtap="onDietTap"
          >
            <text>{{item.label}}</text>
          </view>
        </view>
      </view>
      <!-- çœæ—¶å¼€å…³ -->
      <view class="pref-section pref-switch-row">
        <text class="pref-label">çœæ—¶æ¨¡å¼</text>
        <switch checked="{{userPreference.isTimeSave}}" bindchange="onTimeSaveChange" color="#E8A87C"/>
      </view>
      <view class="pref-hint" wx:if="{{userPreference.isTimeSave}}">
        <text class="pref-hint-icon">â±ï¸</text>
        <text class="pref-hint-text">ä¼˜å…ˆæ¨èå¿«æ‰‹èœï¼Œè®©åšé¥­æ›´è½»æ¾</text>
      </view>
    </view>
  </view>

  <view class="home-brand">
    <view class="brand-line"></view>
    <text class="brand-text">TableSync</text>
  </view>

  <view class="bottom-bar">
    <button class="premium-btn {{btnShrinking ? 'shrinking' : ''}}" bindtap="handleGenerate">
      <text class="btn-text {{btnShrinking ? 'fade-out' : ''}}">çœ‹çœ‹ä»Šå¤©åƒä»€ä¹ˆ</text>
    </button>
  </view>

  <!-- é£è¡Œåœ†ç‚¹ï¼ˆè½¬åœºåŠ¨ç”»ï¼‰ -->
  <view
    class="flying-dot {{dotFlying ? 'fly-to-center' : ''}}"
    wx:if="{{showFlyingDot}}"
  ></view>
</view>
