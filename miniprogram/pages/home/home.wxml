//<wxs src="./home.wxs" module="utils" />
<view class="home-container">
  <view class="brand-header">
    <view class="header-content">
      <text class="date-badge">{{currentDate}}</text>
      <text class="main-title">今日餐桌</text>
      <text class="sub-quote">为您统筹一桌好饭</text>
    </view>
  </view>

  <view class="selection-area">
    <view class="selection-group">
      <text class="group-label">家里几个人？</text>
      <view class="card-stack count-stack">
        <view wx:for="{{adultCountOptions}}" wx:key="*this" class="curated-card {{adultCount === item ? 'is-active' : ''}}" data-count="{{item}}" bindtap="onAdultCountTap">
          <text class="card-text">{{item}} 人</text>
        </view>
      </view>
    </view>
    <view class="selection-group">
      <text class="group-label">想吃几荤几素？</text>
      <view class="combo-stack">
        <view wx:for="{{comboOptions}}" wx:key="label" class="combo-btn {{item.meatCount === meatCount && item.vegCount === vegCount && (item.soupCount || 0) === (soupCount || 0) ? 'is-active' : ''}}" data-meat="{{item.meatCount}}" data-veg="{{item.vegCount}}" data-soup="{{item.soupCount || 0}}" bindtap="onComboTap">
          <text class="combo-text">{{item.label}}</text>
          <text wx:if="{{item.tag}}" class="combo-tag">{{item.tag}}</text>
        </view>
      </view>
    </view>
    <view class="has-baby-row">
      <text class="has-baby-label">宝宝同行？</text>
      <switch checked="{{hasBaby}}" bindchange="onHasBabyChange" color="#C1663E"/>
    </view>
    <view wx:if="{{hasBaby}}" class="selection-group baby-age-section">
      <text class="group-label">宝宝月龄</text>
      <view class="baby-age-stack">
        <view wx:for="{{babyAgeOptions}}" wx:key="value" class="baby-age-card {{item.value === babyMonth ? 'is-active' : ''}}" data-value="{{item.value}}" bindtap="onBabyAgeTap">
          <text class="baby-age-card-label">{{item.label}}</text>
          <text class="baby-age-card-sub">{{item.sub}}</text>
        </view>
      </view>
      <view class="baby-diff-tag">
        <text class="baby-diff-icon">💡</text>
        <text class="baby-diff-text">大人孩子可共用基底，一锅出更省心</text>
      </view>
    </view>
  </view>

  <!-- 个性化偏好折叠面板 -->
  <view class="pref-panel">
    <view class="pref-header" bindtap="togglePrefPanel">
      <text class="pref-header-text">口味 / 偏好</text>
      <text class="pref-header-arrow {{prefExpanded ? 'is-expanded' : ''}}">▼</text>
    </view>
    <view class="pref-body {{prefExpanded ? 'is-expanded' : ''}}">
      <!-- 忌口选择（多选） -->
      <view class="pref-section">
        <text class="pref-label">忌口（可多选）</text>
        <view class="pref-tag-group">
          <view 
            wx:for="{{avoidOptions}}" 
            wx:key="value" 
            class="pref-tag {{utils.includes(userPreference.avoidList, item.value) ? 'is-selected' : ''}}"
            data-value="{{item.value}}"
            bindtap="onAvoidTap"
          >
            <text>{{item.label}}</text>
          </view>
        </view>
      </view>
      <!-- 饮食偏好（单选） -->
      <view class="pref-section">
        <text class="pref-label">饮食偏好</text>
        <view class="pref-tag-group">
          <view 
            wx:for="{{dietOptions}}" 
            wx:key="value" 
            class="pref-tag {{userPreference.dietStyle === item.value ? 'is-selected' : ''}}"
            data-value="{{item.value}}"
            bindtap="onDietTap"
          >
            <text>{{item.label}}</text>
          </view>
        </view>
      </view>
      <!-- 省时开关 -->
      <view class="pref-section pref-switch-row">
        <text class="pref-label">省时模式</text>
        <switch checked="{{userPreference.isTimeSave}}" bindchange="onTimeSaveChange" color="#C1663E"/>
      </view>
      <view class="pref-hint" wx:if="{{userPreference.isTimeSave}}">
        <text class="pref-hint-icon">⏱️</text>
        <text class="pref-hint-text">优先推荐快手菜，让做饭更轻松</text>
      </view>
    </view>
  </view>

  <view class="home-brand">
    <view class="brand-line"></view>
    <text class="brand-text">TableSync</text>
  </view>

  <view class="bottom-bar">
    <button class="premium-btn" bindtap="handleGenerate">看看今天吃什么</button>
  </view>
</view>
