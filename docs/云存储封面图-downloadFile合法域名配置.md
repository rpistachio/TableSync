# 我的菜谱库封面图不显示：配置 downloadFile 合法域名

## 原因

「我的菜谱库」的封面来自云存储。小程序通过 `wx.cloud.getTempFileURL` 拿到 **HTTPS 临时链接** 后，用 `<image src="{{临时链接}}">` 显示。  
微信要求：**所有用于下载/展示的 HTTPS 域名** 必须在小程序后台配置为 **downloadFile 合法域名**，否则图片会加载失败（空白或占位图标）。

## 如何确认域名

1. 打开「我的菜谱库」页面并下拉刷新。
2. 在开发者工具或真机 vConsole 的 Console 中查看日志，例如：
   ```text
   [myRecipes] 封面临时链接已获取，域名: xxxxx.tcb.qcloud.la — 若封面不显示请将该域名加入小程序 downloadFile 合法域名
   ```
3. 记下这里的 **域名**（如 `cloud1-7g5mdmib90e9f670.tcb.qcloud.la`），用于下面配置。

## 配置步骤

### 方式一：小程序已关联云开发（推荐）

1. 打开 [腾讯云开发控制台](https://tcb.cloud.tencent.com)。
2. 进入你的环境（与 `cloud1-7g5mdmib90e9f670` 对应）。
3. 在 **素材与管理** 或 **设置** 中找到「小程序域名配置」/「downloadFile 合法域名」。
4. 添加域名：`https://你环境对应的域名`（如 `https://cloud1-7g5mdmib90e9f670.tcb.qcloud.la`，以控制台或文档为准）。
5. 保存后，云开发会自动同步到微信公众平台。

### 方式二：在微信公众平台手动配置

1. 登录 [微信公众平台](https://mp.weixin.qq.com/) → 你的小程序。
2. **开发** → **开发管理** → **开发设置** → **服务器域名**。
3. 在 **downloadFile 合法域名** 中点击「修改」→「添加」。
4. 填入域名，格式为：`https://你从日志中看到的域名`（例如 `https://cloud1-7g5mdmib90e9f670.tcb.qcloud.la`）。
5. 保存（每月最多修改 5 次，请确认后再提交）。

## 开发阶段临时验证

若仅需在本地/体验版验证封面是否正常：

- 在微信开发者工具中勾选：**详情 → 本地设置 → 不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书**。  
勾选后，未配置域名时封面也可能能显示；**正式发布前必须按上面步骤配置合法域名**。

## 小结

- 云函数和数据库里的 `coverUrl`（fileID）是正确的。
- 封面不显示是因为 **展示临时链接的域名未加入 downloadFile 合法域名**。
- 按上面步骤把日志里打印的域名配置为 downloadFile 合法域名后，刷新「我的菜谱库」即可正常显示封面。
